<div class="page-header">
  <h1>Your Groups</h1>
  <%= link_to new_group_path, class: "new-list-btn" do %>
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
    </svg>
    New Group
  <% end %>
</div>

<% if @groups.any? %>
  <div class="groups-cards">
    <% @groups.each do |group| %>
      <% is_selected = group == Current.session&.selected_group %>
      <div class="group-card <%= 'group-card-selected' if is_selected %>">
        <form action="<%= switch_group_path %>" method="post" style="display: contents;">
          <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
          <%= hidden_field_tag :_method, 'patch' %>
          <%= hidden_field_tag :group_id, group.id %>

          <div class="group-radio">
            <h3><%= group.name %></h3>
            <% if is_selected %>
              <span class="selected-badge">Current</span>
            <% end %>
          </div>
          <div class="group-actions">
            <%= link_to 'Edit', edit_group_path(group) %>
            <%= link_to 'Invite', invite_group_path(group) %>
            <% user_group = Current.user.user_groups.find_by(group: group) %>
            <% unless is_selected %>
              <%= submit_tag 'Switch', class: 'button button-small' %>
            <% end %>
            <% unless user_group&.is_default %>
              <%= link_to 'Leave', leave_group_path(group), method: :delete, data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to leave #{group.name}?" }, class: 'button button-danger button-small' %>
            <% end %>
          </div>
        </form>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="empty-state">
    <div class="empty-state-icon">
      <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
        <circle cx="9" cy="7" r="4"/>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
      </svg>
    </div>
    <p class="empty-state-title">No groups yet</p>
    <p class="empty-state-text">Create a group to start sharing shopping lists</p>
    <%= link_to "Create your first group", new_group_path, class: "button" %>
  </div>
<% end %>

<div class="flex justify-center mt-3">
  <%= link_to "View Invitations", group_invitations_path, class: "button-ghost" %>
</div>
