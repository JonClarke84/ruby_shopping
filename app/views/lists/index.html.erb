<% if @list %>
  <% content_for :title, "Current List for #{@list.date}" %>

  <h1>Shopping list for <%= @list.date.strftime('%A %d %B') %></h1>

  <div id="list-meals" class="card mb-8">
    <h2>Meals</h2>
    <%= form_with( url: list_meals_path(@list), method: :patch, local: true ) do |form| %>
      <div class="grid-cols-1 md:grid-cols-2">
        <% 7.times do |n| %>
          <% date = @list.date + n.days %>
          <% meal = @list.meal_for_date(date) %>
          <div class="form-group">
            <%= form.label date.strftime('%A'), class: "label" %>
            <%= form.text_field "meals[#{date}]", value: meal&.name, class: "input", placeholder: "What's for #{date.strftime('%A')}?" %>
          </div>
        <% end %>
      </div>
      <%= form.hidden_field "group_id", value: @list.group_id %>
      <div class="mt-4">
        <%= form.submit "Update Meals", class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>

  <div class="card mb-8">
    <h2>Add Item</h2>
    <%= form_with model: [@list, @item] do |form| %>
      <div class="flex gap-4 mb-4">
        <div class="form-group flex-1">
          <%= form.label "Item name", class: "label" %>
          <%= form.text_field "name", class: "input", placeholder: "e.g. Milk, Eggs, Bread" %>
        </div>
        <div class="form-group" style="width: 150px;">
          <%= form.label "Quantity", class: "label" %>
          <%= form.number_field "quantity", min: 1, value: 1, class: "input" %>
        </div>
      </div>
      <%= form.hidden_field "group_id", value: @list.group_id %>
      <%= form.submit "Add item", class: "btn btn-primary" %>
    <% end %>
  </div>

  <% if @list.items.any? %>
    <div class="card">
      <h2>Shopping List</h2>
      <ul id="list-items">
        <% @list.list_items.each do |list_item| %>
          <li class="list-item">
            <span><%= list_item.item.name %></span>
            <span class="text-lg"><%= list_item.quantity %></span>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>
<% else %>
  <% content_for :title, "No Lists Yet" %>

  <div class="text-center max-w-md" style="margin: 4rem auto;">
    <h1>No lists yet for this group</h1>
    <p class="mb-6 text-lg">Get started by creating your first shopping list!</p>
    <%= link_to "Create your first list", new_list_path, class: "btn btn-primary" %>
  </div>
<% end %>
